def euclide(a,b):
    assert a>b
    u,v,uu,vv=1,0,0,1
    while b>0:
        (q,r)=divmod(a,b)
        a,u,v,b,uu,vv=b,uu,vv,r,u-q*uu,v-q*vv
    return (a,u,v)

def invmod(x,n):
    assert x<n
    return euclide(n,x)[2]%n

g=2
n=0b110000111001111001111000100111111000011100101010010001101100100110001111001010110001100001011001101001101000111101000000111110010100101100110110110010100101110111010010110001111011100000000000011010101110010110000110011010000001010010010001000000110010001111000000011001011010001101011001000111111011001100000001000110101100000000100100111000101011111001111111010100101100110101001111010100100100110110000100011111101011100110001101110101010100011111111110111101010111111011101110110110010100010010110111001110110101010110110010001111000001111111111011110110001000111101000100100110001110110100010000110111001100101110110011000010110100100111110111101000111011010010000100111010101101010111010100100111011011101100111010010001110100100001110000110101111001000001101110010010001010000001001001111100110101110100111100000110000110001000100001111101111010101001000010000011110000111110010101101100111011

# g^Na mod n (clé Alice)
y=0b001011000001110000000010000101110110111001110101000100000000000100000010110011111101001011000110111100000011011111100100001100001111010001100011101101000110101110100100011110011101110001101100111110001011001011001010101101101101000101101110011011011101001111100000001010000110100111011000001010010111110011110011101100110101111100110001111100101100100010111111001011100001101110011001011000001001011110110011011100011000111101010011001110010101010011100000101001100110110001011100010110110001110001011011100100101111010000000010100011010101101001011000100100101101111000100011111011101011000101001111011010010000100101111011100100100011100101110001000110100001001100101101010101101110011100111001001110100101100010101100101101000000111011101110000100001011110110011101010000101000011110010111001111000010010001011011111110011011010110001010111111110100101110110110111101010010110100000010000100101111

# g^Ni mod n (fausse clé)
ey=0b101001011110101001100000010000110110010101100100100000001100100001001111100000001001001101100011011000001010011000111110111011101100100100010100010100011101100000000010110001100111011000111101100010011101001100010110010111000001000010001101111100101011100111110000101110000010100001011101001110101110101001000111010101011110001101011111001100000001100001110000110111010000001011110100101000001000001110111011001101101100100110001010000011000011010101000111011001001101000101000000110011100101001110111100111011001101110001000011001110101110011101100111010100001101111010110111000111011001111001001111011001000110101111100010101101000011001110111001110100001110101010000110011010110000001000001111101000000011111101110011010111101100100100100110100101111011100100011010000001111011001011111101000000001010011001111010010110110000000011100000101110101110000110100110000000010100001111101001000110111100

# Ni
es=0b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100111011000101110111110011011100001010111000101101100111100110101100111011011110100101111110100110110111100001100111001000101011000111001000101011111101110100000111000110010011100000111100111110011100011000110000001000011001001000110001011110111001010

# g^Nb mod n (clé bob)
ec1=0b000110001001110011110000011100110100110111001101001011100110100000000000010111110001101110001001011011010111001010000000101111011101010100011101100111110011100100001010001001010111001000100001010000010101010101011110001101001000001110010011010011101000011101001011010101101010000111001110111000111100011011101011100011011110011011110010101010000101010100100100010101101011010101100100001100101100000110101110010010010001101111111111101101000010101001111010110001001100000111000011000110010011101010011100001110110110101010100101110000000101111101011101100010010100011101100111001110100000010100111101010001011111101011001001000111000001110000111100100011111111110000101010010110100011010010111010111111101101100100001001001000100110100101010010100000000101000010010101010010111010101111111110101101101100011011111101100000100100111011101000100001000001000010010010010100110011101100000001111100111101

# (message bob : m * K bob*eve)
ec2=0b100101110101100101011000010010001110000001111010011001100101110100110010101011011011101001011111000100111001111001000111010100000000011000111110000101100110111011011001100110011100010011111110011100101001010001000001111010101010100100011010111010100001100110011000001010010010100111110110000100010101110100001110110001100011000011111010111111010101101000011100100001001010010101010111111000010010101110011011110000010010001001100011101010011100001110011001000110001100001111011110010101011010011111010001010011110011011011010010000111110110110100110111110101011100011110000000001111110000100000000011100000110110000111100001100100100011110100000111001010101010101100101101010100101101100101011011101000100101110111100010011110100001101101110000000010101011001010101001011100100010100110110011111111100001001001011100100110010011111011111110001000111100000111010010110011001101001010001101011001100100

kBobEve=pow(ec1,es, n)

# g^Nb^Ni (K bob * eve)^-1
kBobEveInv = pow(kBobEve, -1, n)

msg = (ec2 * kBobEveInv) % n

b = msg.to_bytes((msg.bit_length() + 7) // 8, byteorder="big")

print(b)

secretPrime = msg * (pow(y, es, n))



### EX 3

# calul g^Nb mod n
g = 2
n=999959
bob = int("23268", 16)
resBob = 0
while pow(g,resBob, n) != bob:
    resBob+=1

# calul g^Na mod n
alice = int("4785a", 16)
resAlice = 0
while pow(g,resAlice, n) != alice:
    resAlice+=1
    
print(resBob, resAlice)

KBobAlice = pow(alice, resBob, n)

KBobAliceInv = pow(KBobAlice, -1, n)

ms1hex = int("b756a7c7a78b091b6ec916bd07d72739378988c977fc8c3ab903f239c0d56d8d0690033da692bbbaf2d331b87b0bfdc14458a6709d159e0c8270fe257b72b6cac11339", 16)

msg1_int = (ms1hex * KBobAliceInv) % n
msg1 = msg1_int.to_bytes((msg1_int.bit_length() + 7) // 8, "big")

print(msg1)
